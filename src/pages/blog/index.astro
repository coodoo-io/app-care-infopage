---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const formatDate = (date: Date) =>
  date.toLocaleDateString('de-DE', { year: 'numeric', month: 'long', day: 'numeric' });
---

<BaseLayout
  title="Blog | App-Care"
  description="App-Care Blog: KPI-Guides, App-Wachstumsstrategien und Insights für Mobile App Betreiber."
>
  <!-- Hero -->
  <section class="gradient-hero text-white py-20">
    <div class="section-container">
      <div class="max-w-3xl">
        <span class="badge bg-white/10 text-brand-200 mb-4 inline-block">App-Care Blog</span>
        <h1 class="font-display font-bold text-4xl md:text-5xl text-white mb-6">
          Wissen für App-Betreiber
        </h1>
        <p class="text-brand-200 text-xl leading-relaxed">
          KPI-Guides, App-Wachstumsstrategien und praxisnahe Insights — von App-Experten für App-Betreiber.
        </p>
      </div>
    </div>
  </section>

  <!-- Posts -->
  <section class="section-padding bg-white">
    <div class="section-container max-w-4xl mx-auto">
      {posts.length === 0 ? (
        <div class="text-center py-20">
          <p class="text-gray-500 text-lg">Erste Artikel erscheinen bald.</p>
          <a href={`${import.meta.env.BASE_URL.replace(/\/?$/, '')}/kpis`} class="btn-primary mt-6">KPI Ratgeber lesen</a>
        </div>
      ) : (
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          {posts.map((post) => (
            <article class="card border border-gray-100 hover:border-brand-200 transition-colors group">
              <div class="flex items-center gap-2 mb-3">
                <span class="badge-brand text-xs">{post.data.category}</span>
                <time class="text-xs text-gray-400">{formatDate(post.data.pubDate)}</time>
              </div>
              <h2 class="font-display font-bold text-xl text-gray-900 mb-2 group-hover:text-brand-600 transition-colors">
                <a href={`/blog/${post.id}`}>{post.data.title}</a>
              </h2>
              <p class="text-gray-600 text-sm leading-relaxed mb-4">{post.data.description}</p>
              <div class="flex items-center justify-between">
                <span class="text-xs text-gray-400">von {post.data.author}</span>
                <a href={`/blog/${post.id}`} class="text-brand-600 text-sm font-medium hover:underline">
                  Weiterlesen →
                </a>
              </div>
            </article>
          ))}
        </div>
      )}
    </div>
  </section>

  <!-- Newsletter / Whitepaper CTA -->
  <section class="section-padding gradient-section">
    <div class="section-container text-center max-w-2xl mx-auto">
      <h2 class="section-title mb-4">Bleib auf dem Laufenden</h2>
      <p class="section-subtitle mb-8">Hol dir das kostenlose Whitepaper und erhalte praxisnahe App-KPI Insights.</p>
      <a href={`${import.meta.env.BASE_URL.replace(/\/?$/, '')}/whitepaper`} class="btn-primary">Whitepaper herunterladen</a>
    </div>
  </section>
</BaseLayout>
